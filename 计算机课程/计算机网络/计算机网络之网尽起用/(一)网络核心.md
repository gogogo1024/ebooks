# 数据交换

- $N^2$链路问题

    每一个主机需要和其他的每一个主机需要物理链路相连，当主机数量太多，需要的物理链路数是急剧增加的，当主机数为N时，需要N(N-1)/2 条物理链路，经济成本很大，技术上也存在很大问题，所以用交换设备和每台主机相连，
    但同样的如果主机很多时，就需要交换设备很多端口，以及主机和交换设备之间的距离也是问题，因此把交换设备连在一起，主机和最近的交换设备连接

##  交换

- 动态转接
- 动态分配传输资源

## 数据交换的类型

- 电路交换

  - 最典型的电路交换网络:电话网络
  - 电路交换的三个阶段
    - 建立连接(呼叫/电路建立)
    - 通信
    - 释放连接
  - 独占资源

    这就带来一个问题，如何链路共享，因此就需要多路复用技术
    - 多路复用--链路/网络资源如带宽划分为资源片
      - 将资源片分配给各路呼叫
      - 每条路呼叫独占分配到的资源片进行同行
      - 资源片可能闲置 idle 无共享

      1.频分多路复用FMD(从频率上把用户通过载波信号调频到不同的频带上去，用户之间互不干扰)--有线电视

      2.时分多路复用TDM(将时间划分为一段段等长的时分复用帧，用户在每个TDM帧占用固定序号的时隙，用户占用的时隙是周期性出现，周期就是TDM帧的长度)

      3.波分复用WDM就是光的频分复用(描述光的时候一般用光的波长来描述)

      4.码分多路复用CDM--蜂窝网，卫星通信
        - 每个用户一个唯一的m bit码片序列，其中0用-1表示，1用+1表示)

          - S站的码片序列：（-1 -1 -1 +1 +1 -1 +1 +1）

        - 用户使用相同频率载波，利用各自码片序列编码数据
        - 编码信号=（原始数据）*（码片序列）

          - 如发送比特1（+1），则发送自己的m bit 码片序列
          - 如发送比特0（-1），则发送自己的m bit 码片序列的反码
          - 各用户码片序列相互正交orthogonal

            - $\dfrac 1m$ $S_i\cdot S_j$=0 当i $\neq$j
            - $\dfrac 1m$ $S_i\cdot S_j$=1  当i =j

            - $\dfrac 1m$ $S_i\cdot S_j$=0 当i $\neq$j
            - $\dfrac 1m$ $S_i\cdot S_j$=1  当i =j
        - 码分多路的原理CDM

          - 令{ $d_i$}为原始数据序列，各用户的叠加向量为P=$\sum_{i=1}^Nd_i\cdot S_i$=$\sum_{i=1}^NS_i$(或者反码)
          - 解码:码片序列与编码信号的内积

          $$\dfrac 1mS_i\cdot P= \left\{\begin{array}{cc}
                              1, & \vec{S_i} \in P \\
                              -1, & -\vec{S_i} \in P\\
                              0, &  \vec{S_i},-\vec{S_i}  \notin P
                    \end{array}\right.$$

- 报文(源或者应用发送信息整体)交换

- 分组(报文分拆出来的一系列相对较小的数据包)交换
  - 需要报文的拆分与分组
  - 产生额外开销(每个分组由头部信息和数据两部分组成)
  - 统计多路复用(按需共享链路)statistical multiplexing

  报文交换与分组交换均采用存储-转发交换方式，因此在发送大文件时用报文交换，在发送大量小文件时用分组交换

### 报文交换 VS 分组交换

 分组交换每一个节点是并行的转发分组，而报文交换是串行的转发分组，同时在在报文交换是需要路由的缓存大小为报文的大小，分组交换需要路由的缓存是报文拆分后小数据包的大小
- 报文:M bits
- 链路带宽(数据传输速率):R bps
- 分组长度(大小):L bits
- 跳步数:h
- 路由器数:n

分组交换的报文交付时间T=M/R+(h-1)L/R=M/R+nL/R

报文交换的报文交付时间T=hM/R=(n+1)M/R

特别注意实际上分组交换中报文拆分出来的每个分组需要携带分组头信息

- 1Mb/s链路
- 每个用户:
  - 活动时需100kb/s
  - 平均活动时间10%

对于电路交换来说不管采用哪种多路复用的技术，由于电路交换每个用户独占分配到的资源片，因此只能支持10个用户

对于分组交换来说，由于分组交换是按需共享链路，当一个用户活动时，此时正好另外一个用户不活动，因此只要大家活动时间相互错开，就能互不干扰，对于35个用户，大于10个用户同时活动的概率<0.0004,因此分组交换允许更多用户同时使用网络，分组交换适用于突发数据传输网络，比如发个邮件。如果发送大量数据超越了网络的带宽，就可能产生拥塞congestion，就会产生分组延迟和数据丢失，因此需要协议处理可靠的数据传输和拥塞控制，同时相比于电路交换来说它不能提供电路级别的性能保障，比如就像QQ语音或者视频的停顿问题