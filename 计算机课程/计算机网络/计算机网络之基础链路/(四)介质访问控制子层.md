# 介质访问控制子层

- 多路访问链路采用共享介质连接所有站点，发送站点通过广播方式发送数据并占用整个共享介质的带宽，由于每个站点只需要一条线接入网络就可以访问所有站点，这种网络一般安装简单，价格便宜，局域网local area network--LAN都是使用这种链路
- 在多路访问链路中多个站点同时发送数据，则会产生冲突，这种问题是点到点链路没有的，因此需要重新考虑数据链路层的功能设计
- 介质访问控制子层media access control--MAC，功能就是控制和协调所有站点对共享介质的访问，以避免或减少冲突
- MAC层并不能保证可靠数据传输，所以在MAC子层之上再定义了逻辑链路控制子层logic link control--LLC，用来为上层提供的各种服务
  - LLC1协议提供无确认无连接服务
  - LLC2协议提供有确认面向连接的服务
  - LLC3协议提供有确认无连接的服务

## 802.3的MAC帧格式

|8B|6B|6B|2B|46B~1500B|4B|
|:-------------|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
|前导地址|目的地址|源地址|类型/长度|有效载荷+填充位|帧校验序列|

## 源地址和目标地址(6B)

- 源地址一般为发送方的单播地址。目标地址是接收方的淡泊地址，也可以是多播地址和广播地址
- 单播地址：全球唯一。每个网卡或接口一个，最高节的最低有效位为0，如：06-01-02-01-2C-4B，也称为网卡地址，烧录地址burned-in-address BIA,MAC地址，硬件地址，物理地址
- 多播地址：最高位字节的最低位为1，并且地址非全1，如：01-00-5E-20-01-4B
- 广播地址：全48位都为1

## SMA/CD协议

carrier sense multiple access with collision detection是以太网802.3的MAC子层的协议

 1.发送数据之前先监听信道，信道忙，则继续监听，直到信道空闲，立马就发送
 2.边发送边检测冲突，如果发送完毕都没有检测到冲突，则发送成功
 3.如果检测到冲突，则停止发送，并发送32位干扰以加强冲突信号，采用二进制指数退避算法随机延迟一段时间后重复1步骤

### 二进制指数退避算法binary exponential backoff

- 第一次冲突，从0或者1个时间片中随机选择一个进行延迟
- 第二次冲突，从0，1，2，3个时间片中随机选择一个
- 第i个冲突，从0，1，。。。2的j次方减1个时间片随机选择一个，i<16,j=min(i,10)

前十次冲突后可选择时间片数量每次加倍，后五次冲突后可选择时间片数量不变，所以就叫截止式truncated二进制指数退避算法
其中，时间片的长度为512b的时间，10Mbps的以太网为51.2us

### 接收帧

- 缓存所有的正确的帧，丢弃有错的帧（长度错误，CRC错误等)
- 如果缓存的帧的目的地址为单播地址，则必须与接收帧的网卡的MAC地址一致才会被接收，如果为广播地址，则直接接收它，否则，直接丢弃，把网卡设置为混杂模式就可以接收所有的帧

### 以太网最短帧 512b--64B也称为冲突窗口长度

## 以太网的物理层

### 以太网的传输速率提高后造成的影响

传输速率提高后100倍数，半双工的冲突域也要减少为1/100，即25m，距离不能接收，因此需要采用载波延伸技术延长距离

- 载波延伸carrier extension 通过附加填充字节，使得帧至少为512b，网络半径可以延长到200m,t填充字段称为延伸位extension bits

- 帧突发frame bursting 发送很多短时帧时采用载波延伸浪费很大，可以采用这种技术改进，一次传送多个短帧，第一帧小于512b时进行载波延伸，后面的帧直接发出，不用加载波延伸，每一帧之间有一个小的间隙，填入延伸位

利用帧间空隙96b来分别帧

## 透明网桥

 扩展局域网 --需要有局域网的广播特性

 mac地址表

 |目的MAC地址|转发端口|TTL(ssc time-to-live)|
 |:-------------:|:-------------:|:-------------:|
 |00-50-56-C0-00-08(B)|P1|60|
 |00-1C-C0-42-D5-0A(D)|P2|120|
当接收到一个帧有如下三种选择

- 扩散flood
- 转发forwadr(查询mac地址表)
- 过滤filter

当收到一个单播帧：

- 用该帧的目的MAC地址查询MAC地址表
  - 如果没有查到，就扩散该帧
  - 如果查到，则看其转发端口是否为收到该帧的端口
    - 如果是，则丢弃即过滤该帧
    - 否则，就把该帧从该转发端口发送出去

当网桥收到一多播或广播帧，扩散该帧  
扩散：交换机把帧转发到了除了该帧到达的端口之外的所有接口

### 自学习

- mac地址表初始为空，网桥从端口接收所有的帧，并把接收到的帧的源地址和接收端口记录到mac地址表中

- 如果该源地址在mac地址表中不存在，则增加一个新记录，并启动超时定时器，如果存在，则更新接口并重新启动超时定时器ttl重置

## 生成树协议

待补充

## 虚拟局域网

- 如果网桥只在具有相同颜色的端口port之间转发帧，就会把原来的局域网分割成多个相互隔离的局域网，称为虚拟局域网virtual lan--VLAN

- 网桥之间通过能够转发任意帧的干道相连，一个VLAN的帧只能转发到属于同一个VLAN的端口或者干道端口，只有发往干道端口的帧才需要加上VLAN ID。从干道收到的帧如果没有VLAN ID，则认为是本地VLAN(Native VLAN)，默认为VLAN 1

- 802.1Q
  |8B|6B|6B|2B|2B|2B|46B~1500B|4B|
  |:-------------|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
  |前导地址|目的地址|源地址|协议(指明是VLAN的帧)|VALN ID等|类型/长度|有效载荷+填充位|帧校验序列

- 对于上面的VLAN ID等的具体描述

  |3b|1b|12b|
  |:-------------|:-------------|:-------------|
  |PRI优先权|CFI标准格式指示位|VLANID

## 交换机

把多个网段连接起来的设备，也称为多端口网桥

- 交换结构

- 全双工模式

  交换机工作在全双工模式下，因为没有冲突，CSMA/CD算法可以被关闭

- 自动翻转auto-mdix

  大部分交换机可以自动选择连接方式：交叉线或直通线

- 自适应

  两个站点周期性使用快速链路脉冲选择10M/100M/1000M bps自适应

## 令牌环网

一个通过站点之间传递令牌防止冲突的星形LAN，其标准为IEEE 802.5。

- 令牌环网的数据传送过程

  - 令牌绕环而行，只有截获令牌的站点才能发送数据帧

  - 发送的数据帧通过所有的活动站点

  - 目的站点拷贝数据帧

  -有发送方移除数据帧

  -当没有数据帧要发送或者持有令牌时间到了，当前的发送站点要释放令牌

光纤分布式数据接接口FDDI是采用了令牌环并得到广泛使用的一种100Mbit/s光纤局域网